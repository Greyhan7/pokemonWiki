<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>!!포켓몬 도감!!</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/list.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
</head>
<body>
<div id="search_box">
    <input id="pokemonName" type="text" placeholder="포켓몬 이름">
    <button id="btn_search">🔍</button>
</div>

<div id="pokemonBox" class="pokemonBox">
</div>

</body>
<script src="/pokemon_species_names.js" type="text/javascript"></script>
<script>
    const translator = JSON.parse(JSON.stringify(data));

    $(function(){
        // 포켓몬 한글 이름을 포켓몬 id로 반환
        let translate_KorToId = function (name_kor){
            let id = _.find(translator, function(data){
                if(data.name==name_kor){
                    return data;
                }
            });
            return id.pokemon_species_id;
        };

        // 검색 클릭
        let search_pokemon = "";
        $(document).on('click', '#btn_search', function(){
            search_pokemon = translate_KorToId(document.getElementById('pokemonName').value);
            searchPokemon(search_pokemon);
        })


        // 검색 기능
        let searchPokemon = function(){
            fetch("https://pokeapi.co/api/v2/pokemon/"+search_pokemon)
                .then((response => response.json()))
                .then((data) => {
                    console.log(data);
                    document.querySelector(".pokemonBox").innerHTML = `
                    <div>
                        <img src="${data.sprites.front_default}">
                        <a>${data.name}</a>
                    </div>
                    `;
                })
                .catch((err) => {
                    console.log("해당 포켓몬이 없습니다", err);
                });
        };

        let getPokemonList = function(){
            for(let i =1; i<=1000; i++){
                fetch("https://pokeapi.co/api/v2/pokemon/"+i)
                    .then((response => response.json()))
                    .then((data) => {
                        let box_small = $("<div></div>").attr({
                            id:data.id,
                            class:"box_small"
                        }).css({
                            'float' : 'left',
                            'border' : '1px'
                        });

                        let url = '/pokemonDetail?id='+data.id;
                        let a_link = $("<a></a>").attr('href', url);
                        let img = $("<img>").attr({
                            src: data.sprites.front_default
                        }).css('position', 'relative');

                        a_link.append(img);
                        box_small.append(a_link);
                        $(".pokemonBox").append(box_small);

                        $(document).on('click', '.box_small', function(){
                            sessionStorage.setItem('id', this.id);
                        });
                        fetch("https://pokeapi.co/api/v2/pokemon-species/"+i)
                            .then((response) => response.json())
                            .then((data) => {
                                let box_name = $("<p></p>").text(data.names[2].name).css('text-align', 'center');
                                box_small.append(box_name);
                            })
                    })
                    .catch((err) => {
                        console.log("해당 포켓몬이 없습니다", err);
                    });
                setTimeout(async ()=>console.log("지연"), 200);
            }
        };
        getPokemonList();

    }); // 전체 function
</script>
</html>